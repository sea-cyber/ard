# 用户数据目录结构说明

## 修改内容概述

根据需求，对植被指数计算的文件存储路径进行了以下修改：

### 1. 原始数据路径修改
- **原路径**: `cube_id/raw/quarter`
- **新路径**: `cube_id/quarter`

### 2. 分析结果存储路径修改
- **原路径**: `cube_id/result/quarter/analysis_type`
- **新路径**: `用户数据根目录/username/ARD_CUB_GRIDT0_username_RAW/grid_id/analysis_type`

## 配置文件修改

在 `application.yml` 中添加了用户数据根目录配置：

```yaml
# 自定义ARD配置
ard:
  cube:
    # 立方体根存储目录（按需修改，支持不同环境覆盖）
    root-path: D:/GISER/ard/development/cubedata
  user:
    # 用户数据根目录（用户分析结果存储目录）
    data-root-path: D:/GISER/ard/development/userdata
```

## 新增配置类

创建了 `UserDataConfig.java` 配置类来管理用户数据存储路径：

```java
@Component
@ConfigurationProperties(prefix = "ard.user")
public class UserDataConfig {
    private String dataRootPath = "D:/GISER/ard/development/userdata";
    
    // 构建用户分析结果存储路径
    public String buildUserAnalysisPath(String username, String gridId, String analysisType) {
        String userCubeName = "ARD_CUB_GRIDT0_" + username + "_RAW";
        return dataRootPath + "/" + username + "/" + userCubeName + "/" + gridId + "/" + analysisType;
    }
}
```

## 目录结构示例

### 原始数据目录结构：
```
D:/GISER/ard/development/cubedata/ARD_CUB_GRIDT0_OFF_RAW/
└── grid_id/
    └── quarter1/
        ├── grid_id_quarter1_B4.TIF
        ├── grid_id_quarter1_B5.TIF
        └── ...
```

### 用户分析结果目录结构：
以用户 `ljzhao` 为例，植被指数分析结果的存储路径为：

```
D:/GISER/ard/development/userdata/ARD_CUB_GRIDT0_USR/
└── ljzhao/
    └── GRID_CUBE_T0_N51E016010_RAW/
        └── quarter1/
            └── NDVI_ANALYSIS/
                ├── ndvi_result_1703123456789.tif
                ├── ndvi_result_1703123456790.tif
                └── ...
```

## 修改的文件

1. **配置文件**:
   - `ard/ruoyi-admin/src/main/resources/application.yml` - 添加用户数据根目录配置

2. **新增配置类**:
   - `ard/ruoyi-admin/src/main/java/com/project/ard/dataretrieval/config/UserDataConfig.java` - 用户数据配置类

3. **修改的Java文件**:
   - `NDVIWorkflowProcessor.java` - 修改原始数据路径和结果存储路径
   - `WorkflowTaskController.java` - 添加用户名参数和修改结果保存路径
   - `TaskProcessingServiceImpl.java` - 修改原始数据路径

## 使用说明

1. **原始数据访问**: 现在直接从 `cube_id/quarter` 目录读取原始数据
2. **分析结果存储**: 分析结果存储在用户的专属目录中，格式为 `用户数据根目录/username/ARD_CUB_GRIDT0_username_RAW/grid_id/analysis_type`
3. **用户名处理**: 如果未提供用户名，系统会使用默认值 `default_user`

## 注意事项

- 确保用户数据根目录有足够的存储空间
- 用户名中的特殊字符需要适当处理
- 建议定期清理用户数据目录以节省存储空间
